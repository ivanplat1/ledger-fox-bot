# Следующие шаги после создания таблиц в Supabase

## 1. Настройка переменных окружения

Убедитесь, что в вашем `.env` файле (или в переменных окружения) указаны:

```env
EXPENSECAT_BOT_TOKEN=your-telegram-bot-token
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
OPENAI_API_KEY=your-openai-api-key
```

## 2. Проверка подключения к Supabase

После запуска бота в логах должно быть:
- Если Supabase подключен: `Supabase credentials found. Persistence enabled.`
- Если не подключен: `Supabase credentials not found. Persistence features are disabled...`

## 3. Тестирование сохранения данных

1. **Отправьте чек боту** (команда `/receipt` или просто фото чека)
2. После парсинга в ответе должно быть: `✅ Чек сохранен в базу данных`
3. **Проверьте в Supabase:**
   - Откройте Table Editor в Supabase Dashboard
   - Проверьте таблицу `receipts` - должен появиться новый чек
   - Проверьте таблицу `expenses` - должна появиться запись расхода

## 4. Что сохраняется автоматически

При отправке чека бот автоматически:
- ✅ Сохраняет чек в таблицу `receipts`
- ✅ Создает запись расхода в таблице `expenses`
- ✅ Связывает расход с чеком через `receipt_id`

## 5. Проверка данных в Supabase

### Таблица `receipts`
- `user_id` - ваш Telegram ID
- `store` - название магазина
- `total` - сумма чека
- `items` - JSON с товарами
- `purchased_at` - дата покупки

### Таблица `expenses`
- `user_id` - ваш Telegram ID
- `source` - должно быть `'receipt'`
- `amount` - сумма расхода
- `receipt_id` - ссылка на чек
- `period` - период в формате `YYYY-MM`

## 6. Если что-то не работает

1. **Проверьте логи бота** - там будут ошибки, если что-то пошло не так
2. **Проверьте переменные окружения** - убедитесь, что они правильно установлены
3. **Проверьте права доступа** - Service Role Key должен иметь права на запись
4. **Проверьте структуру таблиц** - убедитесь, что все поля соответствуют схеме

## 7. Дополнительные возможности

После сохранения данных вы можете:
- Использовать команду `/export` для экспорта расходов в CSV
- Создавать отчеты через Supabase Dashboard
- Настроить RLS (Row Level Security) для безопасности


