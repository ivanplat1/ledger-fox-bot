# Сравнение DBaaS решений для ExpenseCatBot

## Текущая ситуация

**Текущие требования:**
- 50,000 MAU (Monthly Active Users)
- ~500 MB базы данных (текущий лимит бесплатного плана Supabase)
- Рост: ~1-2 GB/месяц при активном использовании

**Реальная потребность в данных:**
- Средний размер данных на пользователя: ~100-200 KB (10 чеков × 1.5 KB + расходы + настройки)
- Для 50k MAU: **5-10 GB** (не 500 MB!)
- При росте до 100k MAU: **10-20 GB**

---

## Сравнение DBaaS решений

### 1. Supabase

#### Free Plan
- **База данных:** 500 MB
- **MAU:** 50,000
- **Стоимость:** $0/месяц
- **Ограничения:** 
  - 2 проекта
  - 500 MB базы данных
  - 1 GB файлового хранилища
  - 50,000 MAU

**Когда упремся в лимиты:**
- **По размеру БД:** При ~3,000-5,000 активных пользователей (если хранить все данные)
- **По MAU:** При 50,001 пользователе

#### Pro Plan ($25/месяц)
- **База данных:** 8 GB (включено)
- **MAU:** 100,000 (включено)
- **Дополнительно:** 
  - $0.125 за каждый GB сверх 8 GB
  - $0.00325 за каждого MAU сверх 100k
- **Файлы:** 100 GB

**Когда упремся в лимиты:**
- **По размеру БД:** При ~40,000-80,000 активных пользователей (8 GB)
- **По MAU:** При 100,001 пользователе

**Прогноз стоимости при росте:**
- 50k MAU, 5 GB: **$25/месяц**
- 100k MAU, 10 GB: **$25/месяц** (в пределах лимитов)
- 150k MAU, 15 GB: **$25 + $0.875 (7 GB) + $162.5 (50k MAU) = ~$188/месяц**

---

### 2. Neon (Serverless PostgreSQL)

#### Free Tier
- **База данных:** 0.5 GB (512 MB)
- **Проекты:** 1 проект
- **Стоимость:** $0/месяц
- **Ограничения:**
  - 0.5 GB хранилища
  - Ограниченные compute units

**Когда упремся в лимиты:**
- **По размеру БД:** При ~2,500-5,000 активных пользователей
- **По проектам:** Уже на старте (только 1 проект)

#### Launch Plan ($19/месяц)
- **База данных:** 10 GB (включено)
- **Compute:** 0.5 vCPU, 1 GB RAM
- **Дополнительно:** $0.10 за каждый GB сверх 10 GB

**Когда упремся в лимиты:**
- **По размеру БД:** При ~50,000-100,000 активных пользователей (10 GB)
- **По compute:** При высокой нагрузке (может потребоваться апгрейд)

**Прогноз стоимости при росте:**
- 50k MAU, 5 GB: **$19/месяц**
- 100k MAU, 10 GB: **$19/месяц**
- 150k MAU, 15 GB: **$19 + $0.50 (5 GB) = ~$20/месяц**

**Преимущества:**
- Дешевле чем Supabase Pro
- Serverless (автоматическое масштабирование)
- Branching (копии БД для разработки)

**Недостатки:**
- Нет встроенного Auth (нужно использовать отдельный сервис)
- Нет файлового хранилища (нужен S3 или аналог)

---

### 3. Railway

#### Hobby Plan ($5/месяц)
- **База данных:** 5 GB (включено)
- **Проекты:** Неограниченно
- **Дополнительно:** $0.20 за каждый GB сверх 5 GB

**Когда упремся в лимиты:**
- **По размеру БД:** При ~25,000-50,000 активных пользователей (5 GB)

**Прогноз стоимости при росте:**
- 50k MAU, 5 GB: **$5/месяц**
- 100k MAU, 10 GB: **$5 + $1.00 (5 GB) = $6/месяц**
- 150k MAU, 15 GB: **$5 + $2.00 (10 GB) = $7/месяц**

**Преимущества:**
- Очень дешево
- Простое развертывание
- Неограниченные проекты

**Недостатки:**
- Нет встроенного Auth
- Нет файлового хранилища
- Меньше инструментов для аналитики

---

### 4. Render

#### Free Tier
- **База данных:** 90 дней бесплатно, затем $7/месяц
- **Хранилище:** 1 GB
- **Ограничения:** 
  - База спит после 90 дней неактивности
  - Ограниченная производительность

#### Starter Plan ($7/месяц)
- **База данных:** 1 GB (включено)
- **Дополнительно:** $0.25 за каждый GB сверх 1 GB

**Когда упремся в лимиты:**
- **По размеру БД:** При ~5,000-10,000 активных пользователей (1 GB)

**Прогноз стоимости при росте:**
- 50k MAU, 5 GB: **$7 + $1.00 (4 GB) = $8/месяц**
- 100k MAU, 10 GB: **$7 + $2.25 (9 GB) = ~$10/месяц**

**Недостатки:**
- Дороже чем Railway/Neon
- Меньше хранилища на старте

---

### 5. Aiven

#### Startup Plan ($99/месяц)
- **База данных:** 10 GB (включено)
- **Compute:** 1 vCPU, 2 GB RAM
- **Дополнительно:** $0.10 за каждый GB сверх 10 GB

**Когда упремся в лимиты:**
- **По размеру БД:** При ~50,000-100,000 активных пользователей

**Прогноз стоимости:**
- 50k MAU, 5 GB: **$99/месяц**
- 100k MAU, 10 GB: **$99/месяц**

**Недостатки:**
- Дорого для стартапа
- Overkill для текущих потребностей

---

## Сравнительная таблица

| Провайдер | План | Стоимость | БД (включено) | MAU лимит | 50k MAU | 100k MAU | 150k MAU |
|-----------|------|-----------|---------------|-----------|---------|----------|----------|
| **Supabase** | Free | $0 | 500 MB | 50k | ❌ Недостаточно | ❌ | ❌ |
| **Supabase** | Pro | $25 | 8 GB | 100k | ✅ $25 | ✅ $25 | ⚠️ ~$188 |
| **Neon** | Free | $0 | 512 MB | - | ❌ Недостаточно | ❌ | ❌ |
| **Neon** | Launch | $19 | 10 GB | - | ✅ $19 | ✅ $19 | ✅ ~$20 |
| **Railway** | Hobby | $5 | 5 GB | - | ✅ $5 | ✅ $6 | ✅ $7 |
| **Render** | Starter | $7 | 1 GB | - | ⚠️ $8 | ⚠️ $10 | ⚠️ ~$13 |
| **Aiven** | Startup | $99 | 10 GB | - | ✅ $99 | ✅ $99 | ✅ ~$100 |

---

## Прогноз по количеству пользователей

### При хранении всех данных (без архивации)

| Провайдер | План | Лимит БД | Макс. пользователей* | Когда упремся |
|-----------|------|----------|---------------------|---------------|
| Supabase | Free | 500 MB | ~3,000-5,000 | Очень рано |
| Supabase | Pro | 8 GB | ~40,000-80,000 | При 80k MAU |
| Neon | Launch | 10 GB | ~50,000-100,000 | При 100k MAU |
| Railway | Hobby | 5 GB | ~25,000-50,000 | При 50k MAU |
| Render | Starter | 1 GB | ~5,000-10,000 | Очень рано |

*При среднем размере данных 100-200 KB на пользователя

### При архивации старых данных (хранить только 3 месяца)

| Провайдер | План | Лимит БД | Макс. пользователей* | Когда упремся |
|-----------|------|----------|---------------------|---------------|
| Supabase | Free | 500 MB | ~15,000-25,000 | При 25k MAU |
| Supabase | Pro | 8 GB | ~200,000-400,000 | При 400k MAU |
| Neon | Launch | 10 GB | ~250,000-500,000 | При 500k MAU |
| Railway | Hobby | 5 GB | ~125,000-250,000 | При 250k MAU |
| Render | Starter | 1 GB | ~25,000-50,000 | При 50k MAU |

*При хранении только последних 3 месяцев данных

---

## Рекомендации

### Для старта (0-10k MAU)
1. **Supabase Free** - если хватит 500 MB (с архивацией старых данных)
2. **Railway Hobby ($5)** - если нужна большая БД и дешево
3. **Neon Launch ($19)** - если нужен serverless и больше возможностей

### Для роста (10k-50k MAU)
1. **Railway Hobby ($5-7)** - самое дешевое решение
2. **Neon Launch ($19-20)** - лучший баланс цена/качество
3. **Supabase Pro ($25)** - если нужны встроенные Auth и Storage

### Для масштабирования (50k-100k MAU)
1. **Neon Launch ($19-20)** - оптимально по цене
2. **Supabase Pro ($25)** - если нужны дополнительные сервисы
3. **Railway Hobby ($6-7)** - если бюджет критичен

### Для больших объемов (100k+ MAU)
1. **Neon Launch ($20+)** - лучшее соотношение цена/качество
2. **Supabase Pro ($25+)** - если нужна экосистема Supabase
3. Рассмотреть собственный PostgreSQL на VPS

---

## Стратегия оптимизации данных

### 1. Архивация старых данных
- Хранить только последние 3-6 месяцев в основной БД
- Старые данные переносить в S3/холодное хранилище
- **Экономия:** 70-80% размера БД

### 2. Сжатие JSONB
- Удалить неиспользуемые поля из items
- Использовать более компактный формат
- **Экономия:** 20-30% размера

### 3. Партиционирование
- Разделить таблицы по месяцам/годам
- Упростить удаление старых данных
- **Экономия:** Упрощение управления

### 4. Очистка неактивных пользователей
- Удалять данные пользователей неактивных >6 месяцев
- **Экономия:** Зависит от retention rate

---

## Итоговые рекомендации

### Вариант 1: Остаться на Supabase
- **Плюсы:** Встроенные Auth, Storage, Dashboard
- **Минусы:** Дороже при росте
- **Когда:** Если используете экосистему Supabase

### Вариант 2: Перейти на Neon
- **Плюсы:** Дешевле, serverless, branching
- **Минусы:** Нужен отдельный Auth (Telegram уже есть)
- **Когда:** Если нужна только БД и хотите сэкономить

### Вариант 3: Перейти на Railway
- **Плюсы:** Самое дешевое решение
- **Минусы:** Меньше инструментов
- **Когда:** Если бюджет критичен и нужна только БД

### Вариант 4: Гибридный подход
- **Supabase Free** для Auth/Storage (если нужно)
- **Neon/Railway** для основной БД
- **Когда:** Если используете только БД из Supabase

---

## Вывод

**500 MB недостаточно для 50k MAU** без архивации данных.

**Рекомендация:** 
1. **Краткосрочно:** Остаться на Supabase Free с архивацией старых данных (хранить только 3 месяца)
2. **Среднесрочно:** Перейти на **Neon Launch ($19)** или **Railway Hobby ($5)** при росте
3. **Долгосрочно:** Рассмотреть собственный PostgreSQL при 200k+ MAU

**Оптимальный выбор:** **Neon Launch** - лучший баланс цена/качество для PostgreSQL DBaaS.

