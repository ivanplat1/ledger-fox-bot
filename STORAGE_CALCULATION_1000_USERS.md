# Расчет хранилища для 1000 пользователей на Supabase Free (500 MB)

## Исходные данные

**Тариф:** Supabase Free Plan
**Лимит БД:** 500 MB
**Количество пользователей:** 1,000 MAU

**Средние показатели на пользователя:**
- 10 чеков в месяц (с учетом лимитов: trial 10, premium 100)
- 1 expense = 1 receipt (обычно)
- 20% пользователей импортируют банковские выписки (10 транзакций/месяц)
- 5% пользователей оставляют отзывы (1 отзыв)

**Размер данных:**
- Чек (receipt): ~1.5 KB (JSONB items ~1 KB + метаданные ~0.5 KB)
- Расход (expense): ~250 байт
- Банковская транзакция: ~250 байт
- Настройки пользователя (user_settings): ~100 байт
- Лимиты пользователя (user_limits): ~150 байт
- Отзыв (feedback): ~500 байт
- Индексы: ~20-30% от размера данных

---

## Расчет 1: С архивацией данных старше года

### Данные за 1 год (12 месяцев)

#### Чеки (receipts)
- 1,000 пользователей × 10 чеков/месяц × 12 месяцев = **120,000 чеков**
- Размер: 120,000 × 1.5 KB = **180 MB**

#### Расходы (expenses)
- 1,000 пользователей × 10 расходов/месяц × 12 месяцев = **120,000 расходов**
- Размер: 120,000 × 250 байт = **30 MB**

#### Банковские транзакции (bank_transactions)
- 1,000 × 20% × 10 транзакций/месяц × 12 месяцев = **24,000 транзакций**
- Размер: 24,000 × 250 байт = **6 MB**

#### Настройки пользователей (user_settings)
- 1,000 пользователей × 100 байт = **0.1 MB**

#### Лимиты пользователей (user_limits)
- 1,000 пользователей × 150 байт = **0.15 MB**

#### Отзывы (feedback)
- 1,000 × 5% × 1 отзыв × 500 байт = **0.025 MB**

#### Итого данных:
- Чеки: 180 MB
- Расходы: 30 MB
- Транзакции: 6 MB
- Настройки: 0.1 MB
- Лимиты: 0.15 MB
- Отзывы: 0.025 MB
- **Всего данных: ~216 MB**

#### Индексы (25% от данных):
- 216 MB × 0.25 = **54 MB**

#### Общий размер БД:
- Данные: 216 MB
- Индексы: 54 MB
- **ИТОГО: ~270 MB**

### Результат с архивацией:
✅ **~270 MB из 500 MB** (использовано 54%)
✅ **Остается ~230 MB** для роста
✅ **Можно хранить данные за 1.8-2 года** (500 MB / 270 MB ≈ 1.85 года)

---

## Расчет 2: Без архивации (все данные)

### Рост данных со временем

При стабильной активности 1000 пользователей, каждый год добавляется:
- **~270 MB данных** (как рассчитано выше)

### Накопление данных:

| Период | Накопленный объем | Использование лимита |
|--------|-------------------|---------------------|
| 1 год | ~270 MB | 54% |
| 2 года | ~540 MB | ❌ **108%** (превышение!) |
| 1.5 года | ~405 MB | 81% |
| 1.8 года | ~486 MB | 97% |

### Результат без архивации:
❌ **Упретесь в лимит через ~1.8 года** (540 дней)
⚠️ **Критический уровень (90%) через ~1.6 года** (580 дней)
✅ **Безопасно хранить до ~1.5 года** (405 MB = 81%)

---

## Дополнительные сценарии

### Сценарий 1: Высокая активность (20 чеков/месяц на пользователя)

**С архивацией (1 год):**
- Чеки: 1,000 × 20 × 12 × 1.5 KB = **360 MB**
- Расходы: 1,000 × 20 × 12 × 250 байт = **60 MB**
- Остальное: ~6.3 MB
- Индексы: ~107 MB
- **ИТОГО: ~533 MB** ❌ (превышение лимита!)

**Без архивации:**
- Упретесь в лимит через **~11 месяцев**

### Сценарий 2: Низкая активность (5 чеков/месяц на пользователя)

**С архивацией (1 год):**
- Чеки: 1,000 × 5 × 12 × 1.5 KB = **90 MB**
- Расходы: 1,000 × 5 × 12 × 250 байт = **15 MB**
- Остальное: ~6.3 MB
- Индексы: ~28 MB
- **ИТОГО: ~139 MB** ✅ (использовано 28%)

**Без архивации:**
- Можно хранить данные за **~3.6 года** (500 MB / 139 MB)

### Сценарий 3: Premium пользователи (100 чеков/месяц)

Если 10% пользователей имеют premium подписку (100 чеков/месяц):

**С архивацией (1 год):**
- 900 обычных × 10 чеков = 9,000 чеков/месяц
- 100 premium × 100 чеков = 10,000 чеков/месяц
- Всего: 19,000 чеков/месяц × 12 = 228,000 чеков/год
- Размер чеков: 228,000 × 1.5 KB = **342 MB**
- Расходы: 228,000 × 250 байт = **57 MB**
- Остальное: ~6.3 MB
- Индексы: ~101 MB
- **ИТОГО: ~506 MB** ⚠️ (на грани лимита!)

**Без архивации:**
- Упретесь в лимит через **~11-12 месяцев**

---

## Рекомендации

### Для 1000 пользователей на Supabase Free:

#### ✅ С архивацией данных старше года:
- **Можно безопасно хранить данные за 1.5-2 года**
- Использование: ~270 MB (54% от 500 MB)
- Остается запас: ~230 MB для роста
- **Рекомендуется:** Реализовать автоматическую архивацию данных старше 12 месяцев

#### ⚠️ Без архивации:
- **Можно хранить данные за ~1.5 года** (405 MB = 81%)
- **Критический уровень через ~1.6 года** (486 MB = 97%)
- **Превышение лимита через ~1.8 года** (540 MB)
- **Рекомендуется:** Начать архивацию до достижения 1.5 лет данных

### Стратегия архивации:

1. **Автоматическая архивация:**
   - Ежемесячно архивировать данные старше 12 месяцев
   - Переносить в S3/холодное хранилище
   - Оставлять в БД только последние 12 месяцев

2. **Оптимизация данных:**
   - Сжать JSONB items (удалить неиспользуемые поля)
   - Экономия: 20-30% размера
   - С архивацией + оптимизацией: можно хранить **2-2.5 года** данных

3. **Мониторинг:**
   - Отслеживать размер БД
   - Настроить алерты при достижении 80% лимита
   - Планировать переход на платный план при росте

---

## Выводы

### С архивацией (хранить только последний год):
✅ **~270 MB** (54% от 500 MB)
✅ **Можно безопасно работать до 1,000 пользователей**
✅ **Остается запас ~230 MB** для роста активности
✅ **Можно хранить данные за 1.8-2 года** без проблем

### Без архивации (хранить все данные):
⚠️ **~270 MB за первый год** (54%)
⚠️ **Упретесь в лимит через ~1.8 года** (540 MB)
⚠️ **Критический уровень через ~1.6 года** (486 MB)
❌ **Не рекомендуется** без архивации при долгосрочной работе

### Итоговая рекомендация:
**Для 1000 пользователей на Supabase Free достаточно 500 MB при условии архивации данных старше года.**

Реализуйте автоматическую архивацию, и вы сможете комфортно работать с 1000 пользователями на бесплатном тарифе.

